<!-- File: website/admin-debug.html -->
<!-- Minimal debug version to test login functionality -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Debug - Twinfolks</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 400px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        input, button { 
            width: 100%; 
            padding: 12px; 
            margin: 10px 0; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            box-sizing: border-box;
        }
        button { 
            background: #007cba; 
            color: white; 
            border: none; 
            cursor: pointer; 
        }
        button:hover { background: #005a87; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            padding: 10px; 
            border-radius: 4px; 
            margin: 10px 0; 
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
            padding: 10px; 
            border-radius: 4px; 
            margin: 10px 0; 
        }
        .debug-info {
            background: #e2e3e5;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Admin Login Debug</h1>
        <p>This is a minimal test page to debug the login system.</p>
        
        <div id="step1">
            <h3>Step 1: Test Serverless Function</h3>
            <button onclick="testFunction()">Test Function Connectivity</button>
            <div id="functionResult"></div>
        </div>
        
        <div id="step2">
            <h3>Step 2: Test Login</h3>
            <input type="password" id="testPassword" placeholder="Enter admin password" value="">
            <button onclick="testLogin()">Test Login</button>
            <div id="loginResult"></div>
        </div>
        
        <div id="step3">
            <h3>Step 3: Environment Check</h3>
            <p><strong>Current URL:</strong> <span id="currentUrl"></span></p>
            <p><strong>Function URL:</strong> <span id="functionUrl"></span></p>
        </div>
    </div>

    <script>
        // Display current environment info
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('functionUrl').textContent = window.location.origin + '/.netlify/functions/verify-admin';
        
        // Test if serverless function exists and responds
        async function testFunction() {
            const resultDiv = document.getElementById('functionResult');
            resultDiv.innerHTML = 'Testing...';
            
            try {
                const response = await fetch('/.netlify/functions/verify-admin', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password: 'intentionally_wrong_password' })
                });
                
                const data = await response.json();
                
                if (data.success === false && data.error === 'Invalid password') {
                    resultDiv.innerHTML = '<div class="success">‚úÖ Function is working! Got expected "Invalid password" response.</div>';
                } else {
                    resultDiv.innerHTML = '<div class="error">‚ö†Ô∏è Function responded but with unexpected data:</div><div class="debug-info">' + JSON.stringify(data, null, 2) + '</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="error">‚ùå Function failed: ' + error.message + '</div><div class="debug-info">This usually means the serverless function is not deployed or there\'s a CORS issue.</div>';
            }
        }
        
        // Test actual login
        async function testLogin() {
            const password = document.getElementById('testPassword').value;
            const resultDiv = document.getElementById('loginResult');
            
            if (!password) {
                resultDiv.innerHTML = '<div class="error">Please enter a password</div>';
                return;
            }
            
            resultDiv.innerHTML = 'Testing login...';
            
            try {
                const response = await fetch('/.netlify/functions/verify-admin', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password: password })
                });
                
                const data = await response.json();
                
                if (data.success === true) {
                    resultDiv.innerHTML = '<div class="success">üéâ LOGIN SUCCESS! Password is correct.</div><div class="debug-info">Session token: ' + data.sessionToken + '</div>';
                } else {
                    resultDiv.innerHTML = '<div class="error">‚ùå Login failed: ' + (data.error || 'Unknown error') + '</div><div class="debug-info">' + JSON.stringify(data, null, 2) + '</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="error">‚ùå Login request failed: ' + error.message + '</div>';
            }
        }
        
        // Auto-test function on page load
        window.onload = function() {
            setTimeout(testFunction, 1000);
        };
    </script>
</body>
</html>